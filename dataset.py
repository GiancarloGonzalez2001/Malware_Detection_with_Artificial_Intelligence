
'''

******************************************************************
Rosario University                                               *
Forensics analysis and incident management                        *
Final project                                                    *
2021 - 2s                                                        *
                                                                 *
Giancarlo González                                               *
Ángel López                                                      *
******************************************************************

'''

# Se importan las librerias necesarias
import os
import pefile
import glob


#se abre el archivo en excel
csv = open('MalwareArtifacts.csv','w')

#Se escecifica la ruta de búsqueda del excel
files = glob.glob('/home/angel/Documentos/UR 2021-2/A. Forense/Proyecto Forense*')

#Se crean las cabecera del excel
csv.write("NombreArchivo,AddressOfEntryPoint,MajorLinkerVersion,MajorImageVersion,MajorOperatingSystemVersion,DllCharacteristics,SizeOfStackReserve,NumberOfSections,ResourceSize,\n")

#Se escriben los datos en el excel
for file in files:
    
    #se crea una lista que incluye nombres de archivos
    archivos = ["redbear.exe","ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa.exe","Procmon.exe"]
    
    # for que realiza el proceso de escritura en el excel de manera automática
    for i in range (len(archivos)):
        
        
        suspect_pe = pefile.PE(archivos[i])
        
        csv.write( str(archivos[i]) + ',') 
        csv.write( str(suspect_pe.OPTIONAL_HEADER.AddressOfEntryPoint) + ',')
        csv.write( str(suspect_pe.OPTIONAL_HEADER.MajorLinkerVersion) + ',')
        csv.write( str(suspect_pe.OPTIONAL_HEADER.MajorImageVersion) + ',')
        csv.write( str(suspect_pe.OPTIONAL_HEADER.MajorOperatingSystemVersion)+ ',')
        csv.write( str(suspect_pe.OPTIONAL_HEADER.DllCharacteristics) + ',')
        csv.write( str(suspect_pe.OPTIONAL_HEADER.SizeOfStackReserve) + ',')
        csv.write( str(suspect_pe.FILE_HEADER.NumberOfSections) + ',')
        csv.write( str(suspect_pe.OPTIONAL_HEADER.DATA_DIRECTORY[2].Size) + "\n")

csv.close() #se cierra el excel


print("Proceso de escritura exitoso") # mensaje de prueba